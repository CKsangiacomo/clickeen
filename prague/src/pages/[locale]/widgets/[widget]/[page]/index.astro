---
import Base from '../../../../../layouts/Base.astro';
import Nav from '../../../../../blocks/site/nav/Nav.astro';
import WidgetSubnav from '../../../../../blocks/site/nav/WidgetSubnav.astro';
import Footer from '../../../../../blocks/site/footer.astro';
import { listWidgets, listWidgetPages, loadRequiredWidgetPageJsonForLocale } from '../../../../../lib/markdown';
import { listPragueLocales } from '../../../../../lib/locales';
import { pragueT } from '../../../../../lib/i18n';

const { locale, widget, page } = Astro.params;

type WidgetSubpage = 'overview' | 'templates' | 'examples' | 'features' | 'pricing';
const activeSubpage: WidgetSubpage =
  page === 'overview' || page === 'templates' || page === 'examples' || page === 'features' || page === 'pricing'
    ? (page as WidgetSubpage)
    : 'overview';

export async function getStaticPaths() {
  const widgets = await listWidgets();
  const locales = listPragueLocales();
  const out: { params: { locale: string; widget: string; page: string } }[] = [];

  for (const w of widgets) {
    const pages = await listWidgetPages(w);
    // Hard contract: every marketed widget must have all 4 page JSONs.
    await loadRequiredWidgetPageJsonForLocale({ widget: w, page: 'overview', locale: 'en' });
    for (const p of pages) {
      await loadRequiredWidgetPageJsonForLocale({ widget: w, page: p, locale: 'en' });
    }
    for (const l of locales) {
      for (const p of pages) out.push({ params: { locale: l, widget: w, page: p } });
    }
  }

  return out;
}

function titleCase(s: string) {
  if (!s) return s;
  return s.slice(0, 1).toUpperCase() + s.slice(1);
}

const widgetLabel = titleCase(widget);
const pageLabel = titleCase(page);
// Ensure the page contract exists (fail-fast) even though the UI is currently a stub.
await loadRequiredWidgetPageJsonForLocale({ widget, page, locale });
---

<Base title={`${widgetLabel} — ${pageLabel} — Clickeen`} locale={locale}>
  <main>
    <Nav
      title="Clickeen"
      locale={locale}
      homeHref={`/${locale}/`}
      mode="overlayScroll"
      cta={{ label: pragueT(locale, 'prague.cta.createFree'), href: `/${locale}/create`, variant: 'primary' }}
    />
    <WidgetSubnav locale={locale} widget={widget} active={activeSubpage} />

    <section class="ck-canvas ck-widgetSubpage">
      <div class="ck-inline ck-stack ck-widgetSubpage__inner">
        <h1 class="heading-2 ck-widgetSubpage__title">{widgetLabel} — {pageLabel}</h1>
        <p class="body-xxl ck-widgetSubpage__body">{pragueT(locale, 'prague.common.comingSoon')}</p>
      </div>
    </section>

    <Footer locale={locale} />
  </main>
</Base>

<style>
  .ck-widgetSubpage { padding-top: 0; }
  .ck-widgetSubpage__inner { gap: var(--space-3); }
  .ck-widgetSubpage__title { margin: 0; }
  .ck-widgetSubpage__body {
    margin: 0;
    color: color-mix(in oklab, var(--color-system-black), transparent 56%);
  }
</style>
