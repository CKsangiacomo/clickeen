---
import {
  actionGroupFromLegacy,
  actionGroupToPrimitives,
  assertPrimitives,
  type ActionGroup,
} from '@clickeen/composition';
import PrimitiveRenderer from '@clickeen/composition/renderers/astro/PrimitiveRenderer.astro';

type Props = {
  headline: string;
  subheadline?: string;
  primaryCta?: {
    label: string;
    href: string;
  };
  actionGroup?: ActionGroup;
};

const { headline, subheadline, primaryCta, actionGroup } = Astro.props;

const headerPrimitives = assertPrimitives(
  [
    {
      type: 'heading',
      level: 2,
      content: headline,
      className: 'display-2 ck-m0',
    },
    ...(subheadline
      ? [
          {
            type: 'text',
            variant: 'body',
            content: subheadline,
            className: 'body-website ck-m0 ck-text-secondary',
          },
        ]
      : []),
  ],
  'cta.header',
);

const resolvedActionGroup =
  actionGroup ??
  actionGroupFromLegacy(primaryCta ?? null, null, {
    layout: 'row',
    className: '',
    primaryClassName: 'ck-btn--lg label-l',
    primaryAttrs: { 'data-ck-copy': 'ctaText' },
  });
---

<section class="ck-canvas ck-cta">
  <div class="ck-inline">
    <div class="ck-cta__content ck-stack ck-gap-loose">
      <header class="ck-cta__header ck-stack ck-gap-tight">
        <PrimitiveRenderer primitives={headerPrimitives} />
      </header>
      {resolvedActionGroup ? (
        <div class="ck-cta__cta">
          <PrimitiveRenderer primitives={[actionGroupToPrimitives(resolvedActionGroup)]} />
        </div>
      ) : null}
    </div>
  </div>
</section>

<style>
  /* Be explicit: page `body` is gray; this block must paint its own surface. */
  .ck-canvas.ck-cta {
    background-color: var(--color-system-white);
  }

  .ck-canvas.ck-cta .ck-cta__content {
    padding: var(--space-10) 0;
    max-width: 980px;
    margin-inline: auto;
    text-align: center;
    align-items: center;
  }

  .ck-canvas.ck-cta .ck-cta__header {
    max-width: 880px;
    margin-inline: auto;
  }

  .ck-canvas.ck-cta .ck-cta__cta {
    display: flex;
    justify-content: center;
    width: 100%;
  }

  @media (max-width: 900px) {
    .ck-canvas.ck-cta .ck-cta__content {
      padding: var(--space-8) 0;
    }
  }
</style>
